<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3.&nbsp;Deploying Variman</title><meta content="DocBook XSL Stylesheets V1.65.1" name="generator"><link rel="home" href="index.html" title="
      Variman User's Manual
    "><link rel="up" href="index.html" title="
      Variman User's Manual
    "><link rel="previous" href="install.html" title="2.&nbsp;Installation"><link rel="next" href="bibliography.html" title="Bibliography"><meta content="Experimental LDP.XSL $Revision: 1.4 $" name="generator" xmlns="http://www.w3.org/TR/xhtml1/transitional"/>
  <!-- Generated by LDP XSLT customization layer
      based on Norman Walsh's DocBook XSL stylesheets.
      More information at http://www.linuxdoc.org/ -->
  </head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">3.&nbsp;Deploying Variman</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="install.html">Prev</a>&nbsp;</td><th align="center" width="60%">&nbsp;</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="bibliography.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="deploy"></a>3.&nbsp;Deploying Variman</h2></div></div><div></div></div><p>
    This chapter describes how to configure and run Variman.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="first-time"></a>3.1.&nbsp;First Time Configuration</h3></div></div><div></div></div><p>
      Before running Variman for the first time, there are a few steps
      you need to take.  Variman requires access to a database.
      Currently, Variman supports PostgreSQL [<a href="bibliography.html#bib-postgres" title="[Postgres]">6</a>] and Microsoft SQL Server.  This database
      is where RETS data is stored, as well as Variman specific
      information.  Variman requires read/write access to the database,
      as well as the ability to create new tables.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="postgres"></a>3.1.1.&nbsp;PostgreSQL Setup</h4></div></div><div></div></div><p>
        PostgreSQL must be configured to accept TCP/IP connections, as
        this is how the JDBC driver connects.  This is done adding the
        following setting in <tt class="filename">postgresql.conf</tt>:
      </p><table width="90%" bgcolor="#E0E0E0" border="0" xmlns="http://www.w3.org/TR/xhtml1/transitional"><tr><td><pre class="programlisting">tcpip_socket = true
</pre></td></tr></table><p>
        You may also have to edit <tt class="filename">pg_hba.conf</tt> to
        make network connections permissible.  See the documentation
        in that file for details.
      </p><p>
        It is probably a good idea to create a user other than the
        default <tt class="literal">postgres</tt> superuser.  This user must
        have read and write access, and permissions to create new
        tables in the database used by Variman.
      </p><p>
        The JDBC driver for Postgres version 7.4.x is included with
        the distribution.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="ms-sql-server"></a>3.1.2.&nbsp;Microsoft SQL Server Setup</h4></div></div><div></div></div><p>
        First, either choose an existing database, or create a new
        database for use with Variman.  Then, create a new user that
        has the following role memberships:
      </p><div class="itemizedlist"><ul type="disc"><li><tt class="literal">public</tt></li><li><tt class="literal">db_owner</tt></li><li><tt class="literal">db_datareader</tt></li><li><tt class="literal">db_datawriter</tt></li></ul></div><p>
        The Open Source jTDS [<a href="bibliography.html#bib-jtds" title="[jTDS]">5</a>] driver is
        included with Variman.  The only other supported driver is the
        commercial JSQLConnect driver from JNetDirect [<a href="bibliography.html#bib-jnetdirect" title="[JNetDirect]">4</a>].  The driver that Microsoft offers
        is buggy and does not work with Variman.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc"></a>3.1.3.&nbsp;Installing a JDBC Driver</h4></div></div><div></div></div><p>
        The easiest way to install your JDBC driver is to use the
        Administration Tool.  Choose the Install Jar command from the
        File menu.  You must then restart the Administration Tool
        and/or Variman to use the new JDBC driver.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="db-properties"></a>3.1.4.&nbsp;Configuring Database Properties</h4></div></div><div></div></div><p>
        From the Configuration tab of the Administration Tool, the
        current database properties are listed.  You will have change
        these to suit your environment.  Click on the Edit button, to
        bring up the Database Properties dialog, as in <a href="deploy.html#fig-db" title="Figure&nbsp;1.&nbsp;Database Properties Window">Figure&nbsp;1, &ldquo;Database Properties Window&rdquo;</a>.  You should use the Test Connection button
        to make sure that the properties are entered correctly.  If
        the test fails, then neither the Administration Tool nor
        Variman will be able to access your database.
      </p><div class="figure"><a name="fig-db"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Database Properties Window</b></p><div class="mediaobject"><img src="db.png" alt="Database Properties Window"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="schema"></a>3.1.5.&nbsp;Creating the Schema</h4></div></div><div></div></div><p>
        Variman needs tables for it's own use, such as user
        information.  Before you create users and groups, you need to
        create these tables by choosing the Create Schema command from
        the Database menu.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="rets"></a>3.2.&nbsp;Configuring RETS Parameters</h3></div></div><div></div></div><p>
      From the main Configuration panel, as seen in <a href="deploy.html#fig-config" title="Figure&nbsp;2.&nbsp;Configuration Tab">Figure&nbsp;2, &ldquo;Configuration Tab&rdquo;</a>, you can configure various RETS
      parameters.
    </p><div class="figure"><a name="fig-config"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Configuration Tab</b></p><div class="mediaobject"><img src="config.png" alt="Configuration Tab"></div></div><p>
      The Listening Port is the TCP port number that the Variman server
      listens on.  6103 is the standard, well-known port number for
      RETS.  The Metadata Directory points to the root directory of
      the metadata hierarchy.  Configuring metadata is explained in
      <a href="deploy.html#deploy-metadata" title="3.5.&nbsp;Configuring Metadata">Section&nbsp;3.5, &ldquo;Configuring Metadata&rdquo;</a>.  The Image Root and Image
      Pattern parameters are used to allow Variman to serve up images
      for the GetObject transaction.  The Image Root is a directory
      where the images are located.  The Image Pattern is a percent
      substitution pattern that describes the format of the actual
      file names.  The possible patterns and their substitutions are
      listed in <a href="deploy.html#tab-image-pattern" title="Table&nbsp;1.&nbsp;Image Patterns">Table&nbsp;1, &ldquo;Image Patterns&rdquo;</a>.
    </p><div class="table"><a name="tab-image-pattern"></a><p class="title"><b>Table&nbsp;1.&nbsp;Image Patterns</b></p><table summary="Image Patterns" border="1"><colgroup><col><col></colgroup><thead><tr><th>Pattern</th><th>Substitution</th></tr></thead><tbody><tr><td>%k</td><td>Object Key</td></tr><tr><td>%i</td><td>Object Index</td></tr><tr><td>%I</td><td>Object Index, or empty if index is 0</td></tr></tbody></table></div><p>
      For example, if you have pictures
      in <tt class="filename">/home/variman/pictures/</tt>.  The key is
      used as the base file name, with each image given a number.  Say
      there are three pictures for the property
      ID <tt class="literal">LN1001</tt>, the full paths for these pictures
      are:
      <div class="itemizedlist"><ul type="disc"><li><tt class="literal">/home/variman/pictures/LN1001_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/LN1001_2.jpg</tt></li><li><tt class="literal">/home/variman/pictures/LN1001_3.jpg</tt></li></ul></div>
      The, you could set the Image Root
      to <tt class="filename">/home/variman/pictures</tt> and the Image
      Pattern to <tt class="literal">%k_%i.jpg</tt>.
      The <tt class="literal">%k</tt> gets replaced with the object ID, and
      the <tt class="literal">%i</tt> gets replaced with the image number.
    </p><p>
      The <tt class="literal">%k</tt> percent pattern may be proceeded by a
      number modifier that truncates the number of characters used
      during substitution.  This allows files to be split up into
      multiple directories for large installations.  If the number is
      positive, the characters are taken from the front, where if the
      number is negative, the characters are taken from the end. So,
      with a pattern of <tt class="literal">%-2k/%k_%i.jpg</tt>, the first
      picture
      for <tt class="literal">LN1001</tt>, <tt class="literal">LN1002</tt>, <tt class="literal">LN1101</tt>
      would be at the following paths:
      <div class="itemizedlist"><ul type="disc"><li><tt class="literal">/home/variman/pictures/01/LN1001_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/02/LN1002_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/01/LN1101_1.jpg</tt></li></ul></div>
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="users"></a>3.3.&nbsp;Users</h3></div></div><div></div></div><p>
      Users are managed through the Users Tab as seen in <a href="deploy.html#fig-users" title="Figure&nbsp;3.&nbsp;Users Tab">Figure&nbsp;3, &ldquo;Users Tab&rdquo;</a>.  Users may be created, removed, and
      edited from the User menu or contextual menu.  Users may also be
      added and removed from groups.
    </p><div class="figure"><a name="fig-users"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Users Tab</b></p><div class="mediaobject"><img src="users.png" alt="Users Tab"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groups"></a>3.4.&nbsp;Groups</h3></div></div><div></div></div><p>
      Groups are managed through the Groups Tab as seen in <a href="deploy.html#fig-groups" title="Figure&nbsp;4.&nbsp;Groups Tab">Figure&nbsp;4, &ldquo;Groups Tab&rdquo;</a>. Groups may be created and removed from
      the Group menu or contextual menu.
    </p><div class="figure"><a name="fig-groups"></a><p class="title"><b>Figure&nbsp;4.&nbsp;Groups Tab</b></p><div class="mediaobject"><img src="groups.png" alt="Groups Tab"></div></div><p>
      Groups can be given rules to restrict access to data for members
      of this group.  There are two types of rules: filter rules and
      condition rules, which are described below.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="filter-rules"></a>3.4.1.&nbsp;Filter Rules</h4></div></div><div></div></div><p>
        Filter rules allow RETS system names to be filtered out.  If
        none of a users's groups contain any rules, then they have
        access to all system names provided in the metadata.  Rules
        are written for a particular resource and class.  There two
        types of filter rules: include and exclude.  Include rules
        includes only the fields listed.  Exclude rules includes all
        fields except the ones listed.  An example rule is shown in
        <a href="deploy.html#fig-filter-rule" title="Figure&nbsp;5.&nbsp;Filter Rule Dialog">Figure&nbsp;5, &ldquo;Filter Rule Dialog&rdquo;</a>.  The individual fields are
        listed with spaces between them.  If a user is a member of
        multiple groups, then the fields allowed to be seen are a
        union of the fields of each group's set of fields.
      </p><div class="figure"><a name="fig-filter-rule"></a><p class="title"><b>Figure&nbsp;5.&nbsp;Filter Rule Dialog</b></p><div class="mediaobject"><img src="filter_rule.png" alt="Filter Rule Dialog"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="condition-rules"></a>3.4.2.&nbsp;Condition Rules</h4></div></div><div></div></div><p>
        Condition rules allows the generated SQL to be modified and
        given extra conditions.  For example, there may be a column in
        the database called <tt class="code">idx_viewable</tt> with values
        of <tt class="code">Y</tt> or <tt class="code">N</tt>, which determines whether
        or not this row should be visible to IDX users.  To make only
        the rows which are viewable for IDX available, you would use
        the SQL constraint <tt class="code">idx_viewable = 'Y'</tt>, as shown
        in <a href="deploy.html#fig-condition-rule" title="Figure&nbsp;6.&nbsp;Condition Rule Dialog">Figure&nbsp;6, &ldquo;Condition Rule Dialog&rdquo;</a>.  This gets appended
        on to the <tt class="code">WHERE</tt> clause of the generated SQL using
        an <tt class="code">AND</tt> statement.  If a user is a member of
        multiple groups that have condition rules, each SQL constraint
        is appended to the <tt class="code">WHERE</tt> clause in a
        separate <tt class="code">AND</tt> statement.  So one group could
        restrict access to rows that are IDX viewable, while another
        could restrict based on price.  Condition rules are also tied
        to a specific resource and class.  The SQL constraint must use
        the SQL column names, not RETS system names.  This allows some
        powerful behavior, because it could use columns in the
        database that are not mapped to RETS system names.
      </p><div class="figure"><a name="fig-condition-rule"></a><p class="title"><b>Figure&nbsp;6.&nbsp;Condition Rule Dialog</b></p><div class="mediaobject"><img src="condition_rule.png" alt="Condition Rule Dialog"></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="deploy-metadata"></a>3.5.&nbsp;Configuring Metadata</h3></div></div><div></div></div><p>
      Metadata describes how to map property data in your relational
      database to RETS names.  The metadata is stored as compact
      format metadata, split into multiple files.  For more
      information on compact metadata format, see RETS specification.
      A sample set of metadata is provided on the Variman website, and
      should be used as a starting point.
    </p></div></div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="install.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="index.html">Up</a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="bibliography.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">2.&nbsp;Installation&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;Bibliography</td></tr></table></div></body></html>
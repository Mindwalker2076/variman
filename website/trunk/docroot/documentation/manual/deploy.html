<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3.&nbsp;Configuration</title><meta content="DocBook XSL Stylesheets V1.65.1" name="generator"><link rel="home" href="index.html" title="
      Variman User's Manual
    "><link rel="up" href="index.html" title="
      Variman User's Manual
    "><link rel="previous" href="install.html" title="2.&nbsp;Installation"><link rel="next" href="metadata.html" title="4.&nbsp;Metadata"><meta xmlns="http://www.w3.org/TR/xhtml1/transitional" content="Experimental LDP.XSL $Revision: 1.1 $" name="generator"/>
  <!-- Generated by LDP XSLT customization layer
      based on Norman Walsh's DocBook XSL stylesheets.
      More information at http://www.linuxdoc.org/ -->
  </head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">3.&nbsp;Configuration</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="install.html">Prev</a>&nbsp;</td><th align="center" width="60%">&nbsp;</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="metadata.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="deploy"></a>3.&nbsp;Configuration</h2></div></div><div></div></div><p>
    This chapter describes how to configure and run Variman.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="first-time"></a>3.1.&nbsp;First Time Configuration</h3></div></div><div></div></div><p>
      Before running Variman for the first time, there are a few steps
      you need to take.  Variman requires access to a database.
      Currently, Variman supports PostgreSQL [<a href="bibliography.html#bib-postgres" title="[Postgres]">6</a>] and Microsoft SQL Server.  This database
      is where RETS data is stored, as well as Variman specific
      information.  Variman requires read/write access to the database,
      as well as the ability to create new tables.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="variman-setup"></a>3.1.1.&nbsp;Variman Setup</h4></div></div><div></div></div><p>
        Beneath the WEB-INF/rets directory you will find two files:
        rets-config.xml.dist and rets-logging.properties.dist. You
        will need to either rename or copy these to rets-config.xml and
        rets-logging.properties in the same directory before you can even 
        run the admin tool.
        You may want to do some hand initiailization with your favorite
        editor of the rets-logging.properties file to set up a higher
        logging level until you get the server functional. Once it is
        functional, set the level back to INFO or the log data will
        get large quite fast.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="postgres"></a>3.1.2.&nbsp;PostgreSQL Setup</h4></div></div><div></div></div><p>
        PostgreSQL must be configured to accept TCP/IP connections, as
        this is how the JDBC driver connects.  This is done adding the
        following setting in <tt class="filename">postgresql.conf</tt>:
      </p><table xmlns="http://www.w3.org/TR/xhtml1/transitional" width="90%" bgcolor="#E0E0E0" border="0"><tr><td><pre class="programlisting">tcpip_socket = true
</pre></td></tr></table><p>
        You may also have to edit <tt class="filename">pg_hba.conf</tt> to
        make network connections permissible.  See the documentation
        in that file for details.
      </p><p>
        It is probably a good idea to create a user other than the
        default <tt class="literal">postgres</tt> superuser.  This user must
        have read and write access, and permissions to create new
        tables in the database used by Variman.
      </p><p>
        The JDBC driver for Postgres version 8.3.x is included with
        the distribution.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="ms-sql-server"></a>3.1.3.&nbsp;Microsoft SQL Server Setup</h4></div></div><div></div></div><p>
        First, either choose an existing database, or create a new
        database for use with Variman.  Then, create a new user that
        has the following role memberships:
      </p><div class="itemizedlist"><ul type="disc"><li><tt class="literal">public</tt></li><li><tt class="literal">db_owner</tt></li><li><tt class="literal">db_datareader</tt></li><li><tt class="literal">db_datawriter</tt></li></ul></div><p>
        The Open Source jTDS [<a href="bibliography.html#bib-jtds" title="[jTDS]">5</a>] driver is
        included with Variman.  The only other supported driver is the
        commercial JSQLConnect driver from JNetDirect [<a href="bibliography.html#bib-jnetdirect" title="[JNetDirect]">4</a>].  The driver that Microsoft offers
        is buggy and does not work with Variman.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc"></a>3.1.4.&nbsp;Installing a JDBC Driver</h4></div></div><div></div></div><p>
        The easiest way to install your JDBC driver is to use the
        Administration Tool.  Choose the Install Jar command from the
        File menu.  You must then restart the Administration Tool
        and/or Variman to use the new JDBC driver.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="db-properties"></a>3.1.5.&nbsp;Configuring Database Properties</h4></div></div><div></div></div><p>
        From the Configuration tab of the Administration Tool, the
        current database properties are listed.  You will have change
        these to suit your environment.  Click on the Edit button, to
        bring up the Database Properties dialog, as in <a href="deploy.html#fig-db" title="Figure&nbsp;1.&nbsp;Database Properties Window">Figure&nbsp;1, &ldquo;Database Properties Window&rdquo;</a>.  You should use the Test Connection button
        to make sure that the properties are entered correctly.  If
        the test fails, then neither the Administration Tool nor
        Variman will be able to access your database.
      </p><div class="figure"><a name="fig-db"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Database Properties Window</b></p><div class="mediaobject"><img src="db.png" alt="Database Properties Window"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="schema"></a>3.1.6.&nbsp;Creating the Schema</h4></div></div><div></div></div><p>
        Variman needs tables for it's own use, such as user
        information.  Before you create users and groups, you need to
        create these tables by choosing the Create Schema command from
        the Database menu.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="rets"></a>3.2.&nbsp;Configuring RETS Parameters</h3></div></div><div></div></div><p>
      From the main Configuration panel, as seen in <a href="deploy.html#fig-config" title="Figure&nbsp;2.&nbsp;Configuration Tab">Figure&nbsp;2, &ldquo;Configuration Tab&rdquo;</a>, you can configure various RETS
      parameters.
    </p><div class="figure"><a name="fig-config"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Configuration Tab</b></p><div class="mediaobject"><img src="config.png" alt="Configuration Tab"></div></div><p>
      The Listening Port is the TCP port number that the Variman server
      listens on.  6103 is the standard, well-known port number for
      RETS.  The Metadata Directory points to the root directory of
      the metadata hierarchy.  Configuring metadata is explained in
      <a href="metadata.html#deploy-metadata" title="4.1.&nbsp;Configuring Metadata">Section&nbsp;4.1, &ldquo;Configuring Metadata&rdquo;</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="deploy-getobject"></a>3.3.&nbsp;Configuring GetObject for Multimedia Objects</h3></div></div><div></div></div><p>
      The RETS GetObject transaction allows you to associate
      multimedia objects with a property listing.  These multimedia
      objects, called <i class="firstterm">objects</i> from now on, are
      grouped into <i class="firstterm">types</i>.  The most common type
      of object is a photograph.  However, you are not limited to only
      photos for RETS object types.  RETS provides some well-known
      object types, as described in <a href="deploy.html#tab-object-types" title="Table&nbsp;1.&nbsp;Well-Known Object Types">Table&nbsp;1, &ldquo;Well-Known Object Types&rdquo;</a>, but this list is only a starting point.  If you have objects
      that do not fall into any of these well-known types, you may use
      your own type.  You should always one of the well-known types,
      if possible, so that RETS clients can properly access the
      objects automatically.
    </p><p>
      A RETS client may only retrieve objects of the same type in a
      single transaction.  Each transaction must also include at least
      one listing ID, called the <i class="firstterm">resource key</i>
      in RETS terminology.  For each resource key, there may be zero
      or more objects within a type, all numbered sequentially
      beginning with 1.  The object number is called
      the <i class="firstterm">object ID</i>.  A RETS client may request
      a specific object by ID, a range of objects by ID, or all of the
      objects for a given resource key.  Each object may also include
      a text description which a RETS client should provide to the
      user.  The object ID 0 is special and designates
      the <i class="firstterm">default object</i>.  For example, some
      RETS clients may only present the user with a single photo, and
      the default object allows you to configure which photo is used
      in these circumstances.
    </p><div class="table"><a name="tab-object-types"></a><p class="title"><b>Table&nbsp;1.&nbsp;Well-Known Object Types</b></p><table summary="Well-Known Object Types" border="1"><colgroup><col><col></colgroup><thead><tr><th>Object Type</th><th>Description</th></tr></thead><tbody><tr><td><tt class="literal">Photo</tt></td><td>
              An image, usually a photograph for the object key.
            </td></tr><tr><td><tt class="literal">Thumbnail</tt></td><td>A lower-resolution image.</td></tr><tr><td><tt class="literal">Plat</tt></td><td>
              An image of the property boundaries.
            </td></tr><tr><td><tt class="literal">Video</tt></td><td>A short video or movie.</td></tr><tr><td><tt class="literal">Audio</tt></td><td>A sound clip.</td></tr><tr><td><tt class="literal">Map</tt></td><td>An image showing a map of the property.</td></tr><tr><td><tt class="literal">VRImage</tt></td><td>
              A multiple-view, possibly interactive image related
              to the property.
            </td></tr></tbody></table></div><p>
      The usual behavior is for all objects matching the RETS client's
      criteria to be sent back to the client in a single GetObject
      response.  For a request that returns a large number of objects,
      however, this may be impractical.  The RETS specification allows
      the RETS server to return only a URL, instead of the object
      itself.  This URL is called a <i class="firstterm">location
      URL</i>.
    </p><p>
      GetObject configuration in Variman is done by the Get Object
      Root, Photo Pattern, and Object Set Pattern parameters in <a href="deploy.html#fig-config" title="Figure&nbsp;2.&nbsp;Configuration Tab">Figure&nbsp;2, &ldquo;Configuration Tab&rdquo;</a>.  There are three ways to map multimedia
      objects to a listing ID&gt; The first is using photo patterns,
      described in <a href="deploy.html#deploy-getobject-photo-patterns" title="3.3.1.&nbsp;Using Photo Patterns">Section&nbsp;3.3.1, &ldquo;Using Photo Patterns&rdquo;</a>
      the second is using object sets, described in <a href="deploy.html#deploy-getobject-object-sets" title="3.3.2.&nbsp;Using Object Sets">Section&nbsp;3.3.2, &ldquo;Using Object Sets&rdquo;</a>, and the third is to use a
      combination of the Get Object Root and the contents of a database table
      to determine the location of the object. This is described in more
      detail by <a href="deploy.html#deploy-getobject-database" title="3.3.3.&nbsp;Using A Database Table">Section&nbsp;3.3.3, &ldquo;Using A Database Table&rdquo;</a>. Object sets are far
      more customizable, but require more work to implement.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="deploy-getobject-photo-patterns"></a>3.3.1.&nbsp;Using Photo Patterns</h4></div></div><div></div></div><p>
        Photo patterns use pattern substitutions to locate files on
        the local files system.  It uses only the the Get Object Root
        and Photo Pattern parameters.  The Get Object Root is a
        directory where the photos are located.  The Photo Pattern is
        a percent substitution pattern that describes the format of
        the actual file names.  The possible patterns and their
        substitutions are listed in <a href="deploy.html#tab-photo-pattern" title="Table&nbsp;2.&nbsp;Photo Patterns">Table&nbsp;2, &ldquo;Photo Patterns&rdquo;</a>.
      </p><div class="table"><a name="tab-photo-pattern"></a><p class="title"><b>Table&nbsp;2.&nbsp;Photo Patterns</b></p><table summary="Photo Patterns" border="1"><colgroup><col><col></colgroup><thead><tr><th>Pattern</th><th>Substitution</th></tr></thead><tbody><tr><td>%k</td><td>Resource Key</td></tr><tr><td>%i</td><td>Object ID</td></tr><tr><td>%I</td><td>Object ID, or empty if the ID is 0</td></tr></tbody></table></div><p>
        For example, if you have pictures
        in <tt class="filename">/home/variman/pictures/</tt>.  The key is
        used as the base file name, with each photo given a number.
        Say there are three pictures for the property
        ID <tt class="literal">LN1001</tt>, the full paths for these
        pictures are:
        <div class="itemizedlist"><ul type="disc"><li><tt class="literal">/home/variman/pictures/LN1001_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/LN1001_2.jpg</tt></li><li><tt class="literal">/home/variman/pictures/LN1001_3.jpg</tt></li></ul></div>
        The, you could set the Get Object Root
        to <tt class="filename">/home/variman/pictures</tt> and the Photo
        Pattern to <tt class="literal">%k_%i.jpg</tt>.
        The <tt class="literal">%k</tt> gets replaced with the object ID,
        and the <tt class="literal">%i</tt> gets replaced with the photo
        number.
      </p><p>
        The <tt class="literal">%k</tt> percent pattern may be proceeded by
        a number modifier that truncates the number of characters used
        during substitution.  This allows files to be split up into
        multiple directories for large installations.  If the number
        is positive, the characters are taken from the front, where if
        the number is negative, the characters are taken from the
        end. So, with a pattern of <tt class="literal">%-2k/%k_%i.jpg</tt>,
        the first picture
        for <tt class="literal">LN1001</tt>, <tt class="literal">LN1002</tt>,
        <tt class="literal">LN1101</tt> would be at the following paths:
        <div class="itemizedlist"><ul type="disc"><li><tt class="literal">/home/variman/pictures/01/LN1001_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/02/LN1002_1.jpg</tt></li><li><tt class="literal">/home/variman/pictures/01/LN1101_1.jpg</tt></li></ul></div>
      </p><p>
        Location URLs given for objects that match a photo pattern
        always point back to Variman.  These are specially coded URLs
        that Variman uses to decode which object to provide to the
        client.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="deploy-getobject-object-sets"></a>3.3.2.&nbsp;Using Object Sets</h4></div></div><div></div></div><p>
        Instead of using a pattern to map to the photos themselves, an
        object set pattern may be used to locate an object set file,
        which is just an XML file describing all the multimedia files.
        This approach is more flexible for the following reasons:
        <div class="itemizedlist"><ul type="disc"><li>
            Object file names do not need to match any pattern.  This
            is useful where object IDs embedded in file names may not
            be sequential.  This often happens when an object is
            deleted, but the other objects are not renumbered.
          </li><li>
            The default object is configurable.  It need not be the
            first object ID.
          </li><li>
            Types of objects other than photos, such as documents and
            video can be provided.
          </li><li>
            Text descriptions may be supplied with objects.
          </li><li>
            Objects need not be stored on the local filesystem.  An
            external media server could be used, and Variman will
            access these objects using HTTP.  Location URLs may
            optionally point directly to the media server.
          </li></ul></div>
        As described above, there must be one oject set file per
        listing ID.  The Object Set Pattern field in <a href="deploy.html#fig-config" title="Figure&nbsp;2.&nbsp;Configuration Tab">Figure&nbsp;2, &ldquo;Configuration Tab&rdquo;</a> is used to locate object sets.  Only
        the <tt class="literal">%k</tt> pattern listed in <a href="deploy.html#tab-photo-pattern" title="Table&nbsp;2.&nbsp;Photo Patterns">Table&nbsp;2, &ldquo;Photo Patterns&rdquo;</a> is available, and the Get Object
        Root is still used as the root directory.  For example, if the
        Get Object Root is set
        to <tt class="literal">/home/variman/objects</tt>, and the Object
        Set Pattern is <tt class="literal">%k.xml</tt>, then the file for
        listing ID <tt class="literal">LN1</tt> would
        be <tt class="literal">/home/variman/objects/LN1.xml</tt>.
      </p><p>
        The default behavior for Variman is to provide location URLs
        that point back to the RETS server.  However, if an external
        media server exists, Variman may provide URLs directly to the
        media server.  These location URLs to an external media server
        are called <i class="firstterm">remote URLs</i>, since the URLs
        point to a remote server, not locally to Variman.  This remote
        URL behavior is optional, though.  You can have a media
        server, and not use remote URLs.  In this case, Variman acts as
        a proxy between the RETS client and the media server.  Also
        note that if location URLs are not requested by the RETS
        client, Variman also acts as a proxy.  There is no way to tell
        a RETS client to use location URLs exclusively, so there is no
        way to disable this proxying.
      </p><p>
        Before getting into the details, here is an example object set
        file for a hypothetical <tt class="literal">LN1</tt>
        property, <tt class="literal">LN1.xml</tt>:
      </p><table xmlns="http://www.w3.org/TR/xhtml1/transitional" width="90%" bgcolor="#E0E0E0" border="0"><tr><td><pre class="programlisting">&lt;?xml version="1.0" ?&gt;
&lt;object-set
   xmlns="http://www.crt.realtors.org/xml/variman/object-set/1"
   resource-key="LN1"
   base="http://media.example.com/pictures/"
   remote-locations="true"&gt;
  &lt;object-group type="Photo"&gt;
    &lt;object src="LN1-1.jpg"
            description="Beautiful frontal view of home." /&gt;
    &lt;object src="LN1-2.jpg" description=""&gt;
    &lt;/object&gt;
    &lt;object default="true" src="LN1-5.jpg" /&gt;
    &lt;object src="LN1-6.jpg"
            description="Large wooded lot in backyard." /&gt;
    &lt;object src="LN1-9.jpg" /&gt;
    &lt;object src="LN1-13.jpg" /&gt;
    &lt;object src="LN1-14.jpg"
            description="Large screened in back porch." /&gt;
    &lt;object src="LN1-17.jpg" /&gt;
    &lt;object src="LN1-22.jpg" /&gt;
    &lt;object src="LN1-24.jpg" /&gt;
  &lt;/object-group&gt;

  &lt;object-group type="Documents" base="documents/"&gt;
    &lt;object src="somedocument.pdf"
            description="Some basic document." /&gt;
    &lt;object default="true" src="disclosures.pdf"
            description="Disclosure statement from current owners." /&gt;
    &lt;object src="2002 tax records.rtf"
            description="County tax records for 2002." /&gt;
  &lt;/object-group&gt;

  &lt;object-group type="Video" base="other/"&gt;
    &lt;object src="LN1_virtual_tour.mov"
            description="Take a virtual tour of this house." /&gt;
  &lt;/object-group&gt;
&lt;/object-set&gt;
</pre></td></tr></table><p>
        The main tag is <tt class="literal">&lt;object-set&gt;</tt>.
        The <tt class="literal">resource-key</tt> attribute is required and
        must match the listing ID.  Following
        the <tt class="literal">&lt;object-set&gt;</tt> tag must be one or
        more <tt class="literal">&lt;object-group&gt;</tt> tags.  There
        should be one object group for each type of multimedia object.
        The <tt class="literal">type</tt> attribute must match
        the <tt class="literal">Type</tt> parameter used by the RETS client.
        Well known types must be used where appropriate.  See Section
        11.4.1 of the RETS specification for a list of well known
        types.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="deploy-getobject-objectset-object-set"></a>3.3.2.1.&nbsp;The &lt;object-set&gt; Tag</h5></div></div><div></div></div><p>
          The <tt class="literal">&lt;object-set&gt;</tt> tag is the top
          level tag.  It has the following attributes:
        </p><div class="table"><a name="tab-object-set"></a><p class="title"><b>Table&nbsp;3.&nbsp;&lt;object-set&gt; Attributes</b></p><table summary="<object-set> Attributes" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Attribute</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td>xmlns</td><td>
                  The XML namespace URL. It must be set
                  to <tt class="literal">http://www.crt.realtors.org/xml/variman/object-set/1</tt></td><td>Required.</td></tr><tr><td>resource-key</td><td>
                  The resource key, which is usually the listing ID for
                  properties.  This must match the listing ID in the
                  file name.
                </td><td>Required.</td></tr><tr><td>base</td><td>
                  The base URL to use for resolving subsequent relative
                  URLs.
                </td><td>
                  A <tt class="literal">file://</tt> URL to the location of
                  this object set file.
                </td></tr><tr><td>remote-locations</td><td>
                  If set to <tt class="literal">true</tt>, then Variman will
                  provide a URL directly to the multimedia server, if
                  requested by the client.  If set
                  to <tt class="literal">false</tt>, all location URLs
                  provided will point back to Variman.  If the object
                  does not point to an external media server (i.e. it
                  is a local URL), then a local location URL is used.
                </td><td><tt class="literal">false</tt>.</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="deploy-getobject-objectset-object-group"></a>3.3.2.2.&nbsp;The &lt;object-group&gt; Tag</h5></div></div><div></div></div><p>
          The <tt class="literal">&lt;object-group&gt;</tt> tag represents a
          group of multimedia objects of the same type.  A RETS client
          specifies an object type during the GetObject transaction,
          and object groups map one-to-one to these object types.
        </p><div class="table"><a name="tab-object-group"></a><p class="title"><b>Table&nbsp;4.&nbsp;&lt;object-group&gt; Attributes</b></p><table summary="<object-group> Attributes" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Attribute</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td>type</td><td>
                  The type of multimedia object in this group.  A
                  well-known object type must be used, if appropriate.
                  RETS well-known types
                  are: <tt class="literal">Photo</tt>, <tt class="literal">Plat</tt>,
                  <tt class="literal">Video</tt>, <tt class="literal">Audio</tt>,
                  <tt class="literal">Thumbnail</tt>, <tt class="literal">Map</tt>,
                  <tt class="literal">VRImage</tt>.
                </td><td>Required.</td></tr><tr><td>base</td><td>
                  The base URL to use for resolving relative URLs in
                  child <tt class="literal">&lt;object&gt;</tt> tags.
                </td><td>
                  The base URL of
                  the <tt class="literal">&lt;object-set&gt;</tt>
                  tag.
                </td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="deploy-getobject-objectset-object"></a>3.3.2.3.&nbsp;The &lt;object&gt; Tag</h5></div></div><div></div></div><p>
          The <tt class="literal">&lt;object&gt;</tt> tag represents a
          single multimedia object.  In terms of RETS, every
          multimedia type has zero or more individual objects.  These
          objects are numbered sequentially, starting from 1.  RETS
          also has the concept of a default object.
        </p><div class="table"><a name="tab-object"></a><p class="title"><b>Table&nbsp;5.&nbsp;&lt;object&gt; Attributes</b></p><table summary="<object> Attributes" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Attribute</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td>src</td><td>
                  The URL to the actual object.  This may be, and
                  usually is, a relative URL, which is resolved
                  against the previous <tt class="literal">base</tt>
                  attributes.  This works in a very similar way to
                  the <tt class="literal">src</tt> attribute of the
                  HTML <tt class="literal">&lt;img&gt;</tt> tag.
                </td><td>Required.</td></tr><tr><td>description</td><td>
                  A text description of this object.
                </td><td>No description.</td></tr><tr><td>default</td><td>
                  If set to <tt class="literal">true</tt>, use this as the
                  default object.  Only one object may be marked as
                  default.  If more than one is marked as default, the
                  first one marked will be used.
                </td><td><tt class="literal">false</tt>.</td></tr></tbody></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="deploy-getobject-database"></a>3.3.3.&nbsp;Using A Database Table</h4></div></div><div></div></div><p>
          The third way to manage the multimedia object uses a combination
          of the Get Object Root and a path that will be extracted from a
          database table. The path that is extracted will be appended to the
          Get Object Root and the resulting path will be used to access the
          object. This method is disabled by default and requires a manual
          change by you to the <tt class="literal">variman/WEB-INF/spring-appContext.xml
          </tt> file.
        </p><p>
          In order to enable this feature, locate this line in the
          <tt class="literal">spring-appContext.xml</tt> file in your deployment
          directory:
          <table xmlns="http://www.w3.org/TR/xhtml1/transitional" width="90%" bgcolor="#E0E0E0" border="0"><tr><td><pre class="programlisting">
          
&lt;!--bean id="customObjectSet" class="org.realtors.rets.server.protocol.DatabaseObjectSet"/--&gt;</pre></td></tr></table>
          and change it to read:
          <table xmlns="http://www.w3.org/TR/xhtml1/transitional" width="90%" bgcolor="#E0E0E0" border="0"><tr><td><pre class="programlisting">
          
&lt;bean id="customObjectSet" class="org.realtors.rets.server.protocol.DatabaseObjectSet"/&gt;</pre></td></tr></table>
        </p><p>
          When you initialize the database as described in <a href="deploy.html#schema" title="3.1.6.&nbsp;Creating the Schema">Section&nbsp;3.1.6, &ldquo;Creating the Schema&rdquo;</a>, a table called <tt class="literal">rets_media</tt> is
          created. This database table consists of the following columns:
          <div class="table"><a name="tab-rets-media"></a><p class="title"><b>Table&nbsp;6.&nbsp;<tt class="literal">rets_media</tt> Database Columns</b></p><table summary="rets_media Database Columns" border="1"><colgroup><col><col></colgroup><thead><tr><th>Column Name</th><th>Description</th></tr></thead><tbody><tr><td><tt class="literal">resource_key</tt></td><td>
                  The resource key for a group of objects. Typeically, this
                  should be the same as the <tt class="literal">ListingID</tt> for
                  your listings.
                </td></tr><tr><td><tt class="literal">object_id</tt></td><td>
                  This is a numeric field that is used to determine the
                  unique object by Listing.
                </td></tr><tr><td><tt class="literal">media_type</tt></td><td>
                  This is the well known name for the media type as identified
                  by <a href="deploy.html#tab-object-types" title="Table&nbsp;1.&nbsp;Well-Known Object Types">Table&nbsp;1, &ldquo;Well-Known Object Types&rdquo;</a>. This is used as part
                  of the index into the table and must not be <tt class="literal">null</tt>.
                  If you only use one media type, you can alter the column in
                  the database to set it's default value (e.g. "Photo").
                </td></tr><tr><td><tt class="literal">description</tt></td><td>
                  This is a description of the media (e.g. "Bedroom 1").
                </td></tr><tr><td><tt class="literal">resource_file_path</tt></td><td>
                  The path to the file containing the object. This path will
                  be appended to the Get Object Root path to create the final
                  path to the object.
                </td></tr><tr><td><tt class="literal">modification_timestamp</tt></td><td>
                  This is a timestamp that should be changed only when the
                  underlying object or description has changed.
                </td></tr><tr><td><tt class="literal">id</tt></td><td>
                  This is an integer field that can be used to uniquely
                  identify an object. It must be unique within all objects
                  in this table.
                </td></tr></tbody></table></div>
        </p><p>
          This table has a composite key as it's primary key. This key is
          made up of the <tt class="literal">resource_id</tt>, 
          <tt class="literal">object_id</tt> and <tt class="literal">media_type</tt>
          columns. The combination of the three columns must be unique for
          each object in the database.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="users"></a>3.4.&nbsp;Users</h3></div></div><div></div></div><p>
      Users are managed through the Users Tab as seen in <a href="deploy.html#fig-users" title="Figure&nbsp;3.&nbsp;Users Tab">Figure&nbsp;3, &ldquo;Users Tab&rdquo;</a>.  Users may be created, removed, and
      edited from the User menu or contextual menu.  Users may also be
      added and removed from groups.
    </p><div class="figure"><a name="fig-users"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Users Tab</b></p><div class="mediaobject"><img src="users.png" alt="Users Tab"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groups"></a>3.5.&nbsp;Groups</h3></div></div><div></div></div><p>
      Groups are managed through the Groups Tab as seen in <a href="deploy.html#fig-groups" title="Figure&nbsp;4.&nbsp;Groups Tab">Figure&nbsp;4, &ldquo;Groups Tab&rdquo;</a> and the Group Dialog, as seen in <a href="deploy.html#fig-group-dialog" title="Figure&nbsp;5.&nbsp;Group Dialog">Figure&nbsp;5, &ldquo;Group Dialog&rdquo;</a>. Groups may be created, edited, and removed
      from the Group menu or contextual menu. The main purpose of groups is to
      restrict data in a number of ways, described below.
    </p><div class="figure"><a name="fig-groups"></a><p class="title"><b>Figure&nbsp;4.&nbsp;Groups Tab</b></p><div class="mediaobject"><img src="groups.png" alt="Groups Tab"></div></div><div class="figure"><a name="fig-group-dialog"></a><p class="title"><b>Figure&nbsp;5.&nbsp;Group Dialog</b></p><div class="mediaobject"><img src="group-dialog.png" alt="Group Dialog"></div></div><p>
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="record-limits"></a>3.5.1.&nbsp;Record Limits</h4></div></div><div></div></div><p>
        If a record limit is enabled for a group, members of this group will
        only be able to retrieve that many records per query, even if more
        records match the search criteria. This limit always overrides any
        user supplied limit. If a user is a member of multiple groups with
        record limits, the lowest limit is taken.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="time-restrictions"></a>3.5.2.&nbsp;Time Restrictions</h4></div></div><div></div></div><p>
        If a time restriction is enabled for a group, then members of this
        group are only allowed during the specified time periods. Any access
        outside the allowed time periods results in an authentication failure.
        Time restrictions may be setup as inclusive or exclusive. Inclusive
        restrictions means the user is only allowed to access the server in
        this time period. They will be denied access outside this period. For
        example, "Allow between 9:00AM and 5:00PM" means the user is allowed
        access between 9AM and 5PM and denied access before 9AM and after 5PM.
        Exclusive restrictions means the user is only allowed to access
        outside this time period. They will be denied access within this
        period. For example, "Deny between 9:00AM and 5:00PM" means the user
        is allowed before 9AM and after 5PM and denied access between 9AM and
        5PM. If a user is a member of multiple groups, the restrictions
        applied to that user is a union of all allowed time periods of all the
        time restrictions.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="query-count-limits"></a>3.5.3.&nbsp;Query Count Limits</h4></div></div><div></div></div><p>
        If a query count limit is enabled for a group, then members of this
        group are only allowed a certain number of search queries in a given
        time period. A user exceeding their query count limit will receive a
        RETS error on all subsequent searches until the time period has
        elapsed. The possible time periods are: per day, per hour, and per
        minute. For example, "5 queries per minute" means that more than 5
        queries per minute result in an error until one minute has elapsed.
        Then, the user will be allowed at most 5 more queries. If a user is a
        member of multiple groups, the most restrictive query count is applied
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="filter-rules"></a>3.5.4.&nbsp;Filter Rules</h4></div></div><div></div></div><p>
        Filter rules allow RETS system names to be filtered out.  If
        none of a users' groups contain any rules, then they have
        access to all system names provided in the metadata.  Rules
        are written for a particular resource and class.  There two
        types of filter rules: include and exclude.  Include rules
        includes only the fields listed.  Exclude rules includes all
        fields except the ones listed.  An example rule is shown in
        <a href="deploy.html#fig-filter-rule" title="Figure&nbsp;6.&nbsp;Filter Rule Dialog">Figure&nbsp;6, &ldquo;Filter Rule Dialog&rdquo;</a>.  The individual fields are
        listed with spaces between them.  If a user is a member of
        multiple groups, then the fields allowed to be seen are a
        union of the fields of each group's set of fields.
      </p><div class="figure"><a name="fig-filter-rule"></a><p class="title"><b>Figure&nbsp;6.&nbsp;Filter Rule Dialog</b></p><div class="mediaobject"><img src="filter_rule.png" alt="Filter Rule Dialog"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="condition-rules"></a>3.5.5.&nbsp;Condition Rules</h4></div></div><div></div></div><p>
        Condition rules allows the generated SQL to be modified and
        given extra conditions.  For example, there may be a column in
        the database called <tt class="code">idx_viewable</tt> with values
        of <tt class="code">Y</tt> or <tt class="code">N</tt>, which determines whether
        or not this row should be visible to IDX users.  To make only
        the rows which are viewable for IDX available, you would use
        the SQL constraint <tt class="code">idx_viewable = 'Y'</tt>, as shown
        in <a href="deploy.html#fig-condition-rule" title="Figure&nbsp;7.&nbsp;Condition Rule Dialog">Figure&nbsp;7, &ldquo;Condition Rule Dialog&rdquo;</a>.  This gets appended
        on to the <tt class="code">WHERE</tt> clause of the generated SQL using
        an <tt class="code">AND</tt> statement.  If a user is a member of
        multiple groups that have condition rules, each SQL constraint
        is appended to the <tt class="code">WHERE</tt> clause in a
        separate <tt class="code">AND</tt> statement.  So one group could
        restrict access to rows that are IDX viewable, while another
        could restrict based on price.  Condition rules are also tied
        to a specific resource and class.  The SQL constraint must use
        the SQL column names, not RETS system names.  This allows some
        powerful behavior, because it could use columns in the
        database that are not mapped to RETS system names.
      </p><div class="figure"><a name="fig-condition-rule"></a><p class="title"><b>Figure&nbsp;7.&nbsp;Condition Rule Dialog</b></p><div class="mediaobject"><img src="condition_rule.png" alt="Condition Rule Dialog"></div></div></div></div></div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="install.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="index.html">Up</a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="metadata.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">2.&nbsp;Installation&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;4.&nbsp;Metadata</td></tr></table></div></body></html>
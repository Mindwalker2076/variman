<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!-- Generated by coWiki 0.3.0-dev (http://www.develnet.org) -->

<html>
<head>
<title>Hibernate - Complex Validations using Interceptor</title>

<meta name="generator" content="coWiki 0.3.0-dev, http://www.develnet.org">
<meta name="robots" content="index, follow">
<meta name="keywords" content="validation interceptor">
<meta name="mssmarttagspreventparsing" content="true">
<meta name="revisit-after" content="7 days">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-15">

<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico">

<style type="text/css" media="screen">
<!--

  a {
    color: #256b87;
    text-decoration: none;
  }

  a:visited {
    color: #888888;
  }

a:hover {
    color: black;
}

  p, ol, ul, li, dl, dt, dd, blockquote {
    font-family: Verdana, Sans-serif;
    font-size: 12px;
    text-align: ;
    line-height: 130%;
    color: #000000;
  }

    UL, OL, LI {
        list-style: square;
        font-size: 100%;
        line-height: 120%;
    }

  td, th {
    font-family: Verdana, Sans-serif;
    font-size: 12px;
    color: #000000;
    font-weight: 500;
  }

  span {
    font-size: 12px;
    color: #000000;
    font-weight: 500;
  }

  blockquote {
    font-size: 100%;
    margin-right: 0px;
  }

  h1, h2, h3, h4, h5, h6  {
    color: #000000;
  }

  h1 { font-size: 150%; margin-top: 10px;}
  h2 { font-size: 130%; font-weight: bold; margin-top: 25px;}
  h3 { font-size: 110%; font-weight: bold; margin-top: 20px;}
  h4 { font-size: 105%; font-weight: bold;}
  h5 { font-size: 100%; font-style: italic; }
  h6 { font-size: 100%; font-style: italic; }

  pre, tt {
    font-size: 90%;
    font-family: monospace;
    color: #000000;
  }

  pre.code {
    font-size: 90%;
    font-family: monospace;
    padding: 5px;
    border-style: solid;
    border-width: 1px;
    border-color: #CCCCCC;
    background-color: #eeeeee;
  }

  hr  {
    width: 100%;
    height: 2px;
    background-color: #CCCCCC;
    border-width: 0px;
    padding: 0px;
    color: #CCCCCC;
  }

  input, textarea  {
    font-size: 90%;
    font-family: monospace;
    color: #000000;
    border-width: 1px;
  }

  input.submit {
    font-family: Verdana, Sans-serif;
    font-size: 12px;
    font-weight: bold;
    background-color: #a0a0a0;
    border-width: 1px;
    color: white;
  }

  textarea {
    padding-left: 2px;
  }

  select {
    font-family: monospace;
    font-size: 13.9px;
    color: #000000;
  }

  fieldset {
    margin: 0px;
    padding: 5px;
  }

  legend {
    font-size: 92%;
  }

  /* ------------------------------------------------------------------*/

  .area {
    border-style: solid;
    border-width: 1px;
    border-left-color: #ffffff;
    border-top-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
    background-color: #FFFFFF;
  }

  .areaoverflow {
    overflow: auto;
    border-style: solid;
    border-width: 1px;
    border-left-color: #ffffff;
    border-top-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
    padding: 3px;
    background-color: #FFFFFF;
  }

  .areainset {
    border-style: solid;
    border-width: 1px;
    border-left-color: #ffffff;
    border-top-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
    padding: 3px;
  }

  .window {
    border-style: outset;
    border-width: 2px;
    border-right-width: 1px;
    border-bottom-width: 1px;
    border-left-color: #ffffff;
    border-top-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
  }

  .wintitle {
    font-family: Verdana, Sans-serif;
    background-color: #59666C;
    color: #FFFFFF;
    font-weight: bold;
    font-size: 13.4px;
  }

  .tuborgbox {
    border-style: solid;
    border-width: 0px;
    border-top-color: #ffffff;
    border-left-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
  }

  .tuborgboxsimple {
    border-style: solid;
    border-width: 1px;
    border-color: black;
  }

  .rappsbox {
  }

  .rappsboxsimple {
    border-style: solid;
    border-width: 0px;
    border-color: black;
  }

  .spacer {
    font-size: 2px;
  }

  .error {
    color: #880000;
  }

  .missing {
    font-size: 90%;
    color: #880000;
    text-decoration: none;
    background-color: #BCAE79;
    border-style: solid;
    border-width: 1px;
    border-left-color: #ffffff;
    border-top-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
  }

  .monospace {
    font-family: monospace;
    font-size: 92%;
  }

  .diff {
    font-family: monospace;
    font-size: 92%;
  }

  .label { font-size: 10px; font-family: Verdana, Sans-Serif; font-weight: bold; color: #ffffff; }


  .label:visited {
    color: white;
  }

  .labeldisabled { text-decoration: none; font-size: 90%; font-weight: bold; color: #CCCCCC; }

  .textbut {
    background-color: #BCAE79;
    border-style: solid;
    border-width: 1px;
    border-top-color: #ffffff;
    border-left-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
    padding-top: 1px;
    padding-bottom: 2px;
  }

  .imgbut {
    border-style: solid;
    border-width: 1px;
    border-top-color: #ffffff;
    border-left-color: #ffffff;
    border-right-color: #ffffff;
    border-bottom-color: #ffffff;
  }

  .breadcrumb {
    font-size:90%;
  }

  .breadcrumb:visited {
  }

  .menubottom {
  }

  .menubottom:visited {
    color: #256b87;
  }

  .tiny {
    font-family: Verdana, Sans-serif;
    font-size: 11px;
  }

  .small {
    font-family: Verdana, Sans-serif;
    font-size: 12px;
  }

  .medium {
    font-family: Verdana, Sans-serif;
    font-size: 13px;
  }

  .big {
    font-family: Verdana, Sans-serif;
    font-size: 20px;
  }

-->
</style>

<script language="JavaScript" type="text/javascript">
<!--

  // Do not remove (or change) the JavaScript part, and wonder about errors.
  // First change your plugins and templates not to use these functions.
  // Never use JavaScript for essential functionalities! You may use it
  // for uncritical and superfluous gimmicks.

  window.onerror = null;
  var undefined;

  // ----------------------------------------------------------------------

  function getParentNodeByName(obj, tag) {
    if (!obj.parentNode) { return false; }

    if (obj.parentNode.nodeName.toLowerCase() == tag.toLowerCase()) {
      return obj.parentNode;
    }

    return getParentNodeByName(obj.parentNode, tag);
  }

  // ----------------------------------------------------------------------

  function getPrevSiblingNodeByName(obj, tag) {
    if (!obj.previousSibling) { return false; }

    if (obj.previousSibling.nodeName.toLowerCase() == tag.toLowerCase()) {
      return obj.previousSibling;
    }

    return getPrevSiblingNodeByName(obj.previousSibling, tag);
  }

  // ----------------------------------------------------------------------

  function getNextSiblingNodeByName(obj, tag) {
    if (!obj.nextSibling) { return false; }

    if (obj.nextSibling.nodeName.toLowerCase() == tag.toLowerCase()) {
      return obj.nextSibling;
    }

    return getNextSiblingNodeByName(obj.nextSibling, tag);
  }

  // ----------------------------------------------------------------------

  function fireClickEvent(nodeId) {
    if (document.getElementById) {
      if (obj = document.getElementById(nodeId)) {
        obj.click();
      }
    }
  }

  // ----------------------------------------------------------------------

  function fireClickEventOnChild(obj, tag) {
    if (obj.hasChildNodes) {
      for (i=0; i<obj.childNodes.length; i++) {
        if (obj.childNodes[i].nodeName.toLowerCase() == tag.toLowerCase()) {

          if (obj.childNodes[i].click) {
            obj.childNodes[i].click();
            break;
          }

        }
      }
    }
  }

  // ----------------------------------------------------------------------

  function mover(obj, color) {
    if (color == undefined) {
      obj.style.backgroundColor = '#59666C';
    } else {
      obj.style.backgroundColor = color;
    }
  }

  // ----------------------------------------------------------------------

  function mout(obj, color) {
    if (color == undefined) {
      obj.style.backgroundColor = '#BCAE79';
    } else {
      obj.style.backgroundColor = color;
    }
  }

  // ----------------------------------------------------------------------

  function moverOnParentName(obj, tag, color) {
    newObj = getParentNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mover(newObj);
    } else {
      mover(newObj, color);
    }
  }

  // ----------------------------------------------------------------------

  function moutOnParentName(obj, tag, color) {
    newObj = getParentNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mout(newObj);
    } else {
      mout(newObj, color);
    }
  }

  // ----------------------------------------------------------------------

  function moverOnPrevSiblingName(obj, tag, color) {
    newObj = getPrevSiblingNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mover(newObj);
    } else {
      mover(newObj, color);
    }
  }

  // ----------------------------------------------------------------------

  function moutOnPrevSiblingName(obj, tag, color) {
    newObj = getPrevSiblingNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mout(newObj);
    } else {
      mout(newObj, color);
    }
  }

  // ----------------------------------------------------------------------

  function moverOnNextSiblingName(obj, tag, color) {
    newObj = getNextSiblingNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mover(newObj);
    } else {
      mover(newObj, color);
    }
  }

  // ----------------------------------------------------------------------

  function moutOnNextSiblingName(obj, tag, color) {
    newObj = getNextSiblingNodeByName(obj, tag);
    if (!newObj) { return; }

    if (color == undefined) {
      mout(newObj);
    } else {
      mout(newObj, color);
    }
  }

//-->
</script>


</head>




<body text="#000000"
      link="#256b87" alink="#256b87"
      vlink="#888888" bgcolor="#FFFFFF"
      leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" style="margin-right:3px"
>
<noindex>

<table width="100%" cellpadding="0" cellspacing="0" border="0">
    <tr>
        <td rowspan="2"width="100%"><a href="index.html"><img
                src="tpl/hibernate2/img/hibernate_logo.gif" width="220" height="63"
                alt="HIBERNATE" border="0"></a></td>
        <td align="right">        
            <a href="http://www.jboss.org/"><IMG
            border="0" src="hib_images/jboss_logo_small_nb.gif" alt="JBoss.org"></a>
        </td>
    </tr>
    <tr>
        <td>
            <table cellpadding="1" cellspacing="0" border="0">
                <tr>
                <td align="right" valign="bottom">
                    
                </td>
                <td valign="bottom" style="font-size:70%; color:#aaaaaa;">&nbsp;|&nbsp;</td>
                <td valign="bottom"  style="font-size: 70%;">
                    <a href="http://forum.hibernate.org/profile.php?mode=register">Register</a>
                </td>
                <td valign="bottom" style="font-size:70%; color:#aaaaaa;">&nbsp;|&nbsp;</td>        
                <td align="right" valign="bottom" width="70">
                    
                </td>
                </tr>
            </table>
        
        </td>
    </tr>
</table>


<table width="100%" bgcolor="#BCAE79" cellspacing="0"
  cellpadding="0" border="0" class="tuborgbox">
  <tr>
    <td width="100%" class="label" height="20">&nbsp;</td>

      
      

      <td>&nbsp;&nbsp;&nbsp;</td>

      

  </tr>
</table>

<table cellpadding="0" cellspacing="0" border="0"><tr><td><img src="tpl/hibernate2/img/0.gif" width="1" height="4" alt="" border="0"></td></tr></table>

</noindex>
<table cellpadding="0" cellspacing="0" border="0">
<tr>
<td>
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
        <td bgcolor="white"
            ><img src="tpl/hibernate2/img/0.gif"
            width="1" height="2" alt="" border="0"></td>
        </tr>
    </table>
</td>
</tr>
<tr>
    <td bgcolor="#cccccc" valign="top" align="left" class="rappsbox">
    
      <table width="165"  bgcolor="#a0a0a0" cellpadding="0"
cellspacing="0" border="0">
<tr>
    <td>

    

      

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="1.html"
            class="label"><span class="label">News</span></a>&nbsp;</td>
        </tr>
      </table>

    

      
          <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
            </tr>
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
             </tr>
          </table>

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="4.html"
            class="label"><span class="label">About</span></a>&nbsp;</td>
        </tr>
      </table>

    

      

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td>&nbsp;&nbsp;</td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="21.html"
            class="label"><span class="label">Feature List</span></a>&nbsp;</td>
        </tr>
      </table>

    

      

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td>&nbsp;&nbsp;</td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="200.html"
            class="label"><span class="label">Road Map</span></a>&nbsp;</td>
        </tr>
      </table>

    

      
          <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
            </tr>
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
             </tr>
          </table>

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="5.html"
            class="label"><span class="label">Documentation</span></a>&nbsp;</td>
        </tr>
      </table>

    

      

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td>&nbsp;&nbsp;</td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="27.html"
            class="label"><span class="label">Related Projects</span></a>&nbsp;</td>
        </tr>
      </table>

    

      

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td>&nbsp;&nbsp;</td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="78.html"
            class="label"><span class="label">External Documentation</span></a>&nbsp;</td>
        </tr>
      </table>

    

      
          <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
            </tr>
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
             </tr>
          </table>

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="6.html"
            class="label"><span class="label">Download</span></a>&nbsp;</td>
        </tr>
      </table>

    

      
          <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
            </tr>
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
             </tr>
          </table>

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="20.html"
            class="label"><span class="label">Forum &amp; Mailinglists</span></a>&nbsp;</td>
        </tr>
      </table>

    

      
          <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
            </tr>
            <tr>
              <td bgcolor="#ffffff"
                ><img src="tpl/hibernate2/img/0.gif"
                width="1" height="1" alt="" border="0"></td>
             </tr>
          </table>

      <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
          <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
          <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="148.html"
            class="label"><span class="label">Support &amp; Training</span></a>&nbsp;</td>
        </tr>
      </table>

    

    <!-- Separator -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
        <td bgcolor="white"
            ><img src="tpl/hibernate2/img/0.gif"
            width="1" height="2" alt="" border="0"></td>
        </tr>
    </table>

    <!-- JIRA fixed position -->
    <table cellpadding="0" cellspacing="0" border="0" bgcolor="#a0a0a0">
        <tr>
        <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
        <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#a0a0a0')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="217.html"
            class="label"><span class="label">JIRA Issue Tracking</span></a></td>
        </tr>
    </table>

    <!-- Separator -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
        <td bgcolor="#FFFFFF"><img src="tpl/hibernate2/img/0.gif"
            width="1" height="2" alt="" border="0"></td>
        </tr>
    </table>

    <!-- WIKI  -->
    <table cellpadding="0" cellspacing="0" border="0" bgcolor="#BCAE79">
        <tr>
        <td></td>
          <td><img src="tpl/hibernate2/img/0.gif" hspace="7" vspace="0" width="1" height="1" alt="" border="0"></td>
        <td height="20"
            onmouseover="moverOnParentName(this, 'TR', '#59666C')"
            onmouseout="moutOnParentName(this, 'TR', '#BCAE79')"
            onmouseup="fireClickEventOnChild(this, 'A')"
            nowrap width="100%"><a onfocus="if (this.blur) this.blur()"
            href="37.html"
            class="label" bgcolor="#BCAE79"><span class="label">Wiki Community Area</label></a></td>
        </tr>
    </table>

    <!-- Separator -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
        <td bgcolor="#FFFFFF"><img src="tpl/hibernate2/img/0.gif"
            width="1" height="2" alt="" border="0"></td>
        </tr>
    </table>

    </td>
</tr></table>

<br/>

<br/>
<div align="center">
<a href="175.html"><img
src="hib_images/hibernate_banner02g_125.gif" width="117" height="125"
alt="Hibernate Public Training Courses" border="0"/></a>
</div>

<br/>

<br/>
<div align="center">
<a href="http://www.manning.com/bauer"><img
src="hib_images/hia_banner01.gif" width="124" height="135"
alt="Get Hibernate in Action eBook!" border="0" /></a>
</div>

<br/>
<br/>
<div align="center">
<img src="hib_images/jw_finalist2003.png" border=0" alt="JavaWorld 2003 Finalist">
</div>

<br/>
<br/>
<div align="center">
<img src="hib_images/jolt_winner.png" border=0" alt="Jolt Award 2004 Winner">
</div>

          
    </td>
    <td valign="top" width="100%">
    
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
      <tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td rowspan="2" width="100%" valign="top">

        <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr height="10">
            <td width="100%">
                <table cellpadding="0" cellspacing="0" border="0">
  <tr>
    <td>
      

        
        <a href="5.html" class="breadcrumb"><b>Documentation</b></a>&nbsp;<tt>&gt;</tt>

      

        
        <a href="36.html" class="breadcrumb"><b>Community Area</b></a>&nbsp;<tt>&gt;</tt>

      

      <span class="breadcrumb">Complex Validations using Interceptor</span>
    </td>
  </tr>
</table>

            </td>
            </tr>
            <tr>
            <td>
                <hr width="100%">
    
                
    
                
<a name="A1"></a><h1>Complex Validations using Interceptor</h1><p>Hibernate offers a couple of different ways to implement validation checking.  Typically, entities are validated either internally by implementing the Validatable interface or externally by implementing the Interceptor interface.  Either is a viable approach for simple &quot;invariant&quot; type checking (not null checks, range checks, etc).</p><p>However, both of these approaches have the (sometimes severe) limitation of not allowing session manipulation during &quot;lifecycle&quot; callbacks.  For the Validatable interface, this includes all of its callback methods; for Interceptor interface, this includes the onFlushDirty(), onSave(), and onDelete() methods.  What this means is that a validation done in these methods cannot perform a query (nor can they even trigger a lazy initialization!).</p><p>One solution is to simply perform these validations in the application's business tier prior to persisting the entities.  However, this tends to lead to code duplication, or even worse forgetting to code the validation check in a certain execution branch.</p><p>The other solution, which will be discussed here, is to defer validations till after the flush using the Interceptor.onPostFlush() callback.  The onPostFlush() method does not have the limitation of not being allowed to perform calls on the session.  This approach does have the drawback that validations do not occur until after SQL statements have been executed against the RDBMS, but even this can be a &quot;pro&quot; as it allows all validation messages across all entities involved in a flush to be collected at a single time.</p><p>Below is a sample implemenation of such an interceptor.  It assumes a base interface or class for a mapped entities named IDomainEntity.</p>
<pre class="code">
public class ValidationInterceptor implements Interceptor, Serializable
{
    private List inserts = new ArrayList();
    private List deletes = new ArrayList();
    private Map updates = new Hashtable();

    public boolean onLoad(
            Object entity,
            Serializable id,
            Object[] state,
            String[] propertyNames,
            Type[] types )
    {
        return false;
    }

    public boolean onSave(
            Object entity,
            Serializable id,
            Object[] state,
            String[] propertyNames,
            Type[] types )
    {
        inserts.add(entity);
        return false;
    }

    public boolean onFlushDirty(
            Object entity,
            Serializable id,
            Object[] currentState,
            Object[] previousState,
            String[] propertyNames,
            Type[] types )
    {
        DeltaSet changes = DeltaSetCalculator.calculateDeltaSet(propertyNames, previousState, currentState);
        updates.put(entity, changes);
        return false;
    }

    public void onDelete(
            Object entity,
            Serializable id,
            Object[] state,
            String[] propertyNames,
            Type[] types )
    {
        deletes.add(entity);
    }

    public void preFlush(java.util.Iterator entities)
    {
        // Can add invariant checking here...
    }

    public void postFlush( java.util.Iterator entities )
    {
        // This implementation does not attempt to &quot;bunch&quot; validations for the entire flush.
        // Instead, as soon as an entity fails, the exception is thrown
        try
        {
            for (Iterator insertItr = inserts.iterator(); insertItr.hasNext(); )
            {
                Validator.validateCreation(insertItr.next());
            }

            for (Iterator updateItr = updates.entrySet().iterator(); updateItr.hasNext(); )
            {
                final Map.Entry updateEntry = (Map.Entry)updateItr.next();
                final Object entity = updateEntry.getKey();
                final DeltaSet changes = (DeltaSet)updateEntry.getValue();
                Validator.validateModification(entity, changes);
            }

            for (Iterator deleteItr = deletes.iterator(); deleteItr.hasNext(); )
            {
                Validator.validateDeletion(deleteItr.next());
            }
        }
        catch(ValidationException e)
        {
            throw new ValidationExceptionRuntimeWrapper(e);
        }
        finally
        {
            inserts.clear();
            updates.clear();
            deletes.clear();
        }
    }
    ...
}
</pre><p>Just be careful that &quot;calculating changes&quot; does not cause initialization of proxies or lazy collections.  Below is a set of utility classes I use to &quot;determine changes&quot;.</p><p>A general interface to represent a change:</p>
<pre class="code">
public interface PropertyDelta
extends java.io.Serializable
{
    public static class Type {}
    public static final Type SIMPLE = new Type();
    public static final Type COLLECTION = new Type();
    public static final Type ASSOCIATION = new Type();

    public String getPropertyName();
    public Class getPropertyType();
    public Type getDeltaType();
}
</pre><p>And its various implementations:</p>
<pre class="code">
public class SimplePropertyDelta
implements PropertyDelta
{
    private String propertyName;
    private Class propertyType;
    private Object oldValue;
    private Object newValue;

    public SimplePropertyDelta( String propertyName, Class propertyType, Object oldValue, Object newValue )
    {
        this.propertyName = propertyName;
        this.propertyType = propertyType;
        this.oldValue = oldValue;
        this.newValue = newValue;
    }

    public String getPropertyName()
    {
        return propertyName;
    }

    public Class getPropertyType()
    {
        return propertyType;
    }

    public Object getOldValue()
    {
        return oldValue;
    }

    public Object getNewValue()
    {
        return newValue;
    }

    public Type getDeltaType()
    {
        return PropertyDelta.SIMPLE;
    }

}
</pre>
<pre class="code">
public class CollectionPropertyDelta
implements PropertyDelta
{
    private String propertyName;
    private Class propertyType;
    private Set additions = new HashSet();
    private Set removals = new HashSet();

    public CollectionPropertyDelta( String propertyName, Class propertyType, Collection oldValue, Collection newValue )
    {
        this.propertyName = propertyName;
        this.propertyType = propertyType;
        calculateAdditionsAndRemovals(oldValue, newValue);
    }

    public CollectionPropertyDelta( String propertyName, Class propertyType, Object[] oldValue, Object[] newValue )
    {
        this( propertyName, propertyType, Arrays.asList(oldValue), Arrays.asList(newValue) );
    }

    public String getPropertyName()
    {
        return propertyName;
    }

    public Class getPropertyType()
    {
        return propertyType;
    }

    public Set getAdditions()
    {
        return Collections.unmodifiableSet(additions);
    }

    public Set getRemovals()
    {
        return Collections.unmodifiableSet(removals);
    }

    public boolean anyChangeDetected()
    {
        return (!getAdditions().isEmpty() &amp;&amp; !getRemovals().isEmpty());
    }

    public PropertyDelta.Type getDeltaType()
    {
        return PropertyDelta.COLLECTION;
    }

    private void calculateAdditionsAndRemovals(Collection oldValue, Collection newValue)
    {
        ////////////////////////////////////////////////////////////////////////
        // First, determine additions
        if (newValue != null)
            additions.addAll(newValue);
        if (oldValue != null)
            additions.removeAll(oldValue);

        ////////////////////////////////////////////////////////////////////////
        // Then, determine removals
        if (oldValue != null)
            removals.addAll(oldValue);
        if (newValue != null)
            removals.removeAll(newValue);
    }
}
</pre>
<pre class="code">
public class AssociationPropertyDelta implements PropertyDelta
{
    private String propertyName;
    private Class propertyType;
    private Object oldId;
    private Object newId;

    public AssociationPropertyDelta(String propertyName, Class propertyType, Long oldId, Long newId)
    {
        this.propertyName = propertyName;
        this.propertyType = propertyType;
        this.oldId = oldId;
        this.newId = newId;
    }

    public String getPropertyName()
    {
        return propertyName;
    }

    public Class getPropertyType()
    {
        return propertyType;
    }

    public Object getOldValue()
    {
        return oldId;
    }

    public Object getNewValue()
    {
        return newId;
    }

    public Type getDeltaType()
    {
        return PropertyDelta.ASSOCIATION;
    }
}

</pre><p>Then a container to hold a collection of changes:</p>
<pre class="code">
public class DeltaSet implements java.io.Serializable
{
    private Set deltas = new java.util.HashSet();
    private HashMap deltaPropertyNames = new HashMap();

    DeltaSet() {}

    void addDelta( PropertyDelta delta )
    {
        deltas.add( delta );
        deltaPropertyNames.put( delta.getPropertyName(), null );
    }

    public Set getDeltas()
    {
        return java.util.Collections.unmodifiableSet( deltas );
    }

    public boolean wasDelta( String propertyName )
    {
        return deltaPropertyNames.containsKey( propertyName );
    }

    void clear()
    {
        deltas.clear();
    }

}
</pre><p>Finally, a convenience class to parse all the changes from a given domain entity (taking great care to not trigger lazy initializations):</p>
<pre class="code">
public class DeltaSetCalculator
{
    private static final Logger log = Logger.getLogger( DeltaSetCalculator.class );
    private static final SimpleDateFormat sdf = new SimpleDateFormat( &quot;YYYY-MM-dd HH:mm:ss:SSS&quot; );

    private DeltaSetCalculator() {}

    /* A hibernate-specific calculation.  Uses the values passed to the Hibernate
     * Interceptor.onFlushDirty() to perform the calculation.
     *
     * @param propertyNames A string array of all the property names passed in to
     * the obFlushDirty method.
     * @param previousState The Object array representing the previous state of
     * the properties named in the propertyNames array.
     * @param currentState The Object array representing the current state of
     * the properties named in the propertyNames array.
     * @return The DeltaSet representing the changes encountered in the property
     * states.
     */
    public static DeltaSet calculateDeltaSet( String[] propertyNames, Object[] previousState, Object[] currentState )
    {
        if (propertyNames == null || previousState == null || currentState == null)
            throw new IllegalArgumentException( &quot;All three arrays passed to calculate a delta-set must be non-null&quot; );
        if (propertyNames.length != previousState.length &amp;&amp; previousState.length != currentState.length)
            throw new IllegalArgumentException( &quot;All three arrays passed to calculate a delta-set must be of the same length&quot; );

        DeltaSet deltaSet = new DeltaSet();
        try
        {
            Class propertyType = null;
            for (int i = 0; i &lt; propertyNames.length; i++)
            {
                log.debug( &quot;Starting property [&quot; + propertyNames[i] + &quot;]&quot; );
                propertyType = null;
                final Object propertyPreviousState = previousState[i];
                final Object propertyCurrentState = currentState[i];
                final boolean wasPreviousNull = propertyPreviousState == null;
                final boolean isCurrentNull = propertyCurrentState == null;

                if (wasPreviousNull &amp;&amp; isCurrentNull)
                {
                    log.debug( &quot;Both were null; skipping&quot; );
                    continue;
                }

                // Try to determine the property type from either currentState or,
                // previousState...  Side-note: if both are null, we cannot determine
                // the propertyType, but thats OK as no change has occurred (null==null)
                if (!isCurrentNull)
                {
                    if (propertyCurrentState instanceof IDomainEntity)
                    {
                        propertyType = IDomainEntity.class;
                    }
                    else
                    {
                        propertyType = propertyCurrentState.getClass();
                    }
                }
                else if (!wasPreviousNull)
                {
                    if (propertyPreviousState instanceof IDomainEntity)
                    {
                        propertyType = IDomainEntity.class;
                    }
                    else
                    {
                        propertyType = propertyPreviousState.getClass();
                    }
                }

                if (propertyType == null)
                {
                    log.debug( &quot;Unable to determine property type; continuing&quot; );
                    continue;
                }

                if (Hibernate.isInitialized(propertyPreviousState) || Hibernate.isInitialized(propertyCurrentState))
                {
                    final PropertyDelta delta = getDeltaOrNull( propertyNames[i], propertyType,
                                                                propertyPreviousState, propertyCurrentState );
                    if (delta != null)
                    {
                        deltaSet.addDelta( delta );
                    }
                }
            }
        }
        catch( Throwable t )
        {
            log.error( &quot;Error determining delta-set&quot;, t );
        }
        finally
        {
            log.debug( &quot;Done delta-set determination&quot; );
        }
        return deltaSet;
    }


    /** General use DeltaSet caluclator.
     */
    public static DeltaSet calculateDeltaSet( Object obj1, Object obj2 )
    {
        if (obj1 == null || obj2 == null)
            throw new IllegalArgumentException( &quot;Both objects passed to calculate a delta-set must be non-null&quot; );

        DeltaSet deltaSet = new DeltaSet();
        try
        {
            BeanInfo beanInfo = Introspector.getBeanInfo( obj1.getClass(), Object.class );
            PropertyDescriptor[] pds = beanInfo.getPropertyDescriptors();

            for (int i=0; i&lt;pds.length; i++)
            {
                final String propertyName = pds[i].getName();
                final Class propertyType = pds[i].getPropertyType();
                final Object oldValue = PropertyUtils.getProperty( obj1, propertyName );
                final Object newValue = PropertyUtils.getProperty( obj2, propertyName );

                final PropertyDelta delta = getDeltaOrNull( propertyName, propertyType, oldValue, newValue );
                if (delta != null)
                {
                    deltaSet.addDelta( delta );
                }
            }
        }
        catch( Throwable t )
        {
            log.error( &quot;Error determining delta-set&quot;, t );
        }
        finally
        {
            log.debug( &quot;Done delta-set determination&quot; );
        }
        return deltaSet;
    }

    public static PropertyDelta getDeltaOrNull( String propertyName, Class propertyType, Object oldValue, Object newValue )
    {
        PropertyDelta delta = null;
        log.debug( &quot;Checking property [name=&quot; + propertyName + &quot;, type=&quot; + propertyType + &quot;]&quot; );

        if (IDomainEntity.class.isAssignableFrom( propertyType ))
        {
            log.debug( &quot;Encountered property is an association type&quot; );
            Long oldId = null;
            Long newId = null;
            if (oldValue != null)   oldId = ((IDomainEntity)oldValue).getId();
            if (newValue != null)   newId = ((IDomainEntity)newValue).getId();

            if (!areEqual( oldId, newId ))
            {
                delta = new AssociationPropertyDelta( propertyName, propertyType, oldId, newId );
            }
        }
        else if (Collection.class.isAssignableFrom( propertyType ))
        {
            log.debug( &quot;Encountered property is a collection type&quot; );

            Collection oldCollectionValue = (Collection)oldValue;
            Collection newCollectionValue = (Collection)newValue;

            if (Hibernate.isInitialized(oldCollectionValue) &amp;&amp; Hibernate.isInitialized(newCollectionValue))
            {
                CollectionPropertyDelta collectionDelta = new CollectionPropertyDelta(
                        propertyName,
                        propertyType,
                        oldCollectionValue,
                        newCollectionValue
                );
                if (collectionDelta != null &amp;&amp; collectionDelta.anyChangeDetected())
                {
                    delta = collectionDelta;
                }
                collectionDelta = null;
            }
            else
            {
                log.info( &quot;One (or both) of a collection property was not previously initialized; have to skip&quot; );
            }
        }
        else if (propertyType.isArray())
        {
            log.debug( &quot;Encountered property is an array type&quot; );

            CollectionPropertyDelta collectionDelta = new CollectionPropertyDelta(
                    propertyName,
                    propertyType,
                    (Object[])oldValue,
                    (Object[])newValue
            );
            if (collectionDelta != null &amp;&amp; collectionDelta.anyChangeDetected())
            {
                delta = collectionDelta;
            }
            collectionDelta = null;
        }
        else
        {
            log.debug( &quot;Property was a simple property&quot; );
            if (!areEqual( oldValue, newValue ))
            {
                delta = new SimplePropertyDelta( propertyName, propertyType, oldValue, newValue );
            }
        }

        if (delta == null)
        {
            log.debug( &quot;No delta occurred&quot; );
        }
        else
        {
            log.debug( &quot;Delta encountered&quot; );
        }
        return delta;
    }

    public static boolean areEqual( Object obj1, Object obj2 )
    {
        if (obj1 == null &amp;&amp; obj2 == null)
        {
            log.debug( &quot;Both were null&quot; );
            return true;
        }
        else if (obj1 == null || obj2 == null)
        {
            log.debug( &quot;One or the other were null (but not both)&quot; );
            return false;
        }
        else if ((Date.class.isAssignableFrom( obj1.getClass() ))
        || (Timestamp.class.isAssignableFrom( obj1.getClass() ))
        || (java.sql.Date.class.isAssignableFrom( obj1.getClass() ))
        || (Time.class.isAssignableFrom( obj1.getClass() )))
        {
            Date d1 = (Date)obj1;
            Date d2 = (Date)obj2;
            return d1.equals(d2) || d2.equals(d1);
        }
        else
        {
            log.debug( &quot;Checking [&quot; + obj1 + &quot;] against [&quot; + obj2 + &quot;]&quot; );
            return obj1.equals( obj2 );
        }
    }

}
</pre>
<a name="A2"></a><h2>Using Session.isDirty to Perform Complex Validations</h2><p>Here's a variation of the above, using the new method Session.isDirty.  It addresses the issue in the comment below about database constraints.</p><p>Background:  You want to use Hibernate to enforce invariants on your persistent entities.  Every time Hibernate updates an object in the database, you want a special validate method to be called.  You can do this by implementing the Validatable interface, but Hibernate doesn't allow you to use the session, trigger lazy loads, etc., in Validatable.validate.   That's fairly limiting.</p><p>You can instead use an interceptor that collects the objects that have been updated, and then after flush is finished, validate all of them.  This is the approach outlined in the 'Complex Validations using Interceptor' Wiki topic.  We independently came up with the same approach about a year ago for our project. (Although we didn't mess with the 'ChangeDeltaSet' calculation stuff.  If any property of the entity has changed, we validate the whole entity.  We do pass the list of dirty properties by diffing the previous/currentState arrays Hibernate passes to onFlushDirty.)</p><p>This works pretty well, but validation occurs <em>after</em> the update.  If there is a 'non-null' constraint on the database, it's too late, we've already blown up with an SQLException.  The integrity of your domain model is still preserved, but it's hard to report a meaningful error to the user.</p><p>Another solution mentioned in the Wiki topic is to use Validatable, but start a new session in validate, and validate the entity with that session.  The problem there is that the temporary sesssion won't share the same IdentityMap, etc., so you could end up loading the same entity twice, having two diferent instances of the same logical entity in memory, one with any applied changes and one without, etc.  So that's out. </p><p>We can improve things by using the Session.isDirty method.  This method acts just like flush, except it doesn't really issue any SQL statements to the database, and Interceptor.postFlush is not called.  Interceptor.onFlushDirty, however, <em>is</em> called.  So, we can write an interceptor that captures the updated entities (like before), and write our own wrapper method for Session.flush which validates the dirty entities <em>before</em> flushing.  The Interceptor would look like this:</p>
<pre class="code">
public class CollectingInterceptor implements Interceptor {

  private static class IdentityKey {
    private Serializable id;
    private Class clazz;

    public IdentityKey(Serializable id, Class clazz) {
      this.id = id;
      this.clazz = clazz;
    }

    public boolean equals(Object obj) {
      IdentityKey rhs = (IdentityKey) obj;
      return (id.equals(rhs.id) &amp;&amp; clazz.equals(rhs.clazz));
    }

    public int hashCode() {
      return id.hashCode() * clazz.hashCode();
    }
  }
  
  private Map dirtyEntitiesMap = new HashMap();

  public boolean onFlushDirty(Object entity,
                            Serializable id,
                            Object[] currentState,
                            Object[] previousState,
                            String[] propertyNames,
                            Type[] types)
                     throws CallbackException {
    dirtyEntitiesMap.put(new IdentityKey(id, entity.getClass()), entity);
  }

  public Set getDirtyEntities() {
    return dirtyEntitiesMap.values();
  }

  // other methods just return their default values...
}
</pre><p>You would pass an instance of this Interceptor to SessionFactory.buildSession.  </p><p>The wrapper method around Session.flush might look like this:</p>
<pre class="code">
public class MySessionWrapper {
  private Session session;
  private CollectingInterceptor interceptor;

  public MySessionWrapper(Session session, CollectingInterceptor interceptor) {
    this.session = session;
    this.interceptor = interceptor;
  }

  public Set getDirtyEntities() {
    session.isDirty();
    return interceptor.getDirtyEntities();
  }

  public void flush() {
    Iterator iter = getDirtyEntities().iterator();
    while (iter.hasNext()) {    
      validate(iter.next());    
    }
  }

  private void validate(Object entity) {
    if (obj instanceof MyValidatable) {
      MyValidatable validatable = (MyValidatable) iter.next();
      validatable.validate();
    }
  }
}
</pre><p>You could of course implement onSave to collect inserted entities and validate them too.  Any entity that wants automatically invoked validation would implement the MyValidatable interface, which would look like this:</p>
<pre class="code">
public inteface MyValidatable {
  public void validate();
}
</pre><p>If you add a validateForDelete method to this interface, and collect deleted entities in CollectingInterceptor.onDelete, you could validate before deleted entities as well.</p><p>It might be nice if Hibernate had a 'Collection Session.getDirtyEntities()' method.  Then we wouldn't need a custom Interceptor.</p><p>Steve Molitor</p><p>smolitor@erac.com</p>

    
                
            </td>
            </tr>
            <tr>
            <td>
                
            </td>
            </tr>
        </table>

        </td>
        <td rowspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
      </tr>
      </table>
    
    </td>
</tr>
</table>


<hr>
<table width="100%" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left">
<A href="http://sourceforge.net/projects/hibernate"><IMG
border="0" src="tpl/hibernate2/img/0.gif" hspace="30" vspace="2"></A>
</td>
<td align="right" valign="middle">
<b><a href="http://www.develnet.org/">coWiki</a>&nbsp;</b>
</td>
</tr>
</table>
</body>
</html>
